<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QRix - Railway Track Fittings Management System</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Component-specific styles -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/overview.css">
    <link rel="stylesheet" href="css/qr-generator.css">
    <link rel="stylesheet" href="css/analytics.css">

    <!-- Third-party libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
</head>
<body>
    <div class="flex h-screen">
        <!-- Dark Mode Toggle -->
        <div class="absolute top-6 right-10 z-40">
            <label class="flex items-center cursor-pointer select-none">
                <span class="mr-3 font-semibold text-color-default">Dark Mode</span>
                <input type="checkbox" id="darkModeSwitch" class="sr-only">
                <span class="w-12 h-6 flex items-center bg-gray-300 rounded-full p-1 transition-colors duration-200" id="switchTrack">
                    <span class="dot w-5 h-5 bg-white rounded-full shadow-md transform transition-transform duration-200" id="switchDot"></span>
                </span>
            </label>
        </div>
        <aside id="sidebar" class="w-64 bg-surface shadow-lg flex flex-col justify-between">
            <div class="p-6 border-b border-color-default">
                <div class="flex items-center gap-3 mb-2">
                    <img src="https://img.icons8.com/color/48/000000/qr-code.png" alt="QRix Logo" class="w-10 h-10 rounded-xl shadow-lg">
                    <h1 class="text-2xl font-bold text-color-default drop-shadow">QRix</h1>
                </div>
                <p class="text-sm text-color-subtle font-medium">Railway Track Fittings Management System</p>
            </div>
            <nav class="p-6 flex-1">
                <ul class="space-y-3">
                    <li>
                        <a href="#" class="nav-link flex items-center gap-3 p-3 text-color-default rounded-xl bg-surface shadow hover:scale-105 hover:shadow-xl transition-all duration-200 border-2 border-transparent" data-page="overview">
                            <span class="text-xl">üìä</span> <span class="font-semibold">Overview</span>
                        </a>
                    </li>
                    <li class="admin-only">
                        <a href="#" class="nav-link flex items-center gap-3 p-3 text-color-default rounded-xl bg-surface shadow hover:scale-105 hover:shadow-xl transition-all duration-200 border-2 border-transparent" data-page="generate-qr">
                            <span class="text-xl">üî≤</span> <span class="font-semibold">Generate QR</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-link flex items-center gap-3 p-3 text-color-default rounded-xl bg-surface shadow hover:scale-105 hover:shadow-xl transition-all duration-200 border-2 border-transparent" data-page="scan-qr">
                            <span class="text-xl">üì∑</span> <span class="font-semibold">Scan QR</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-link flex items-center gap-3 p-3 text-color-default rounded-xl bg-surface shadow hover:scale-105 hover:shadow-xl transition-all duration-200 border-2 border-transparent" data-page="inventory">
                            <span class="text-xl">üì¶</span> <span class="font-semibold">Inventory</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-link flex items-center gap-3 p-3 text-color-default rounded-xl bg-surface shadow hover:scale-105 hover:shadow-xl transition-all duration-200 border-2 border-transparent" data-page="analytics">
                            <span class="text-xl">üìà</span> <span class="font-semibold">Analytics</span>
                        </a>
                    </li>
                    <li class="admin-only">
                        <a href="#" class="nav-link flex items-center gap-3 p-3 text-color-default rounded-xl bg-surface shadow hover:scale-105 hover:shadow-xl transition-all duration-200 border-2 border-transparent" data-page="admin">
                            <span class="text-xl">‚öôÔ∏è</span> <span class="font-semibold">Admin Panel</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <div class="p-6 border-t border-color-default">
                <div id="userInfo" class="text-sm text-color-subtle mb-2"></div>
                <button id="logoutBtn" class="nav-link w-full text-left p-3 text-color-default rounded-xl bg-surface shadow hover:scale-105 hover:shadow-xl transition-all duration-200 hidden border-2 border-transparent">
                    <span class="mr-3">üö™</span> Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto bg-gradient-themed">
            <div id="content" class="p-10">
                <!-- Content will be loaded here dynamically -->
            </div>
        </main>
    </div>

    <!-- ES6 Module Scripts -->
    <script type="module">
        // --- UI Initialization ---
        const darkModeSwitch = document.getElementById('darkModeSwitch');
        const switchTrack = document.getElementById('switchTrack');
        const switchDot = document.getElementById('switchDot');
        function setDarkMode(on) {
            if (on) {
                document.body.classList.add('dark-theme');
                darkModeSwitch.checked = true;
                switchTrack.classList.replace('bg-gray-300', 'bg-blue-600');
                switchDot.style.transform = 'translateX(24px)';
            } else {
                document.body.classList.remove('dark-theme');
                darkModeSwitch.checked = false;
                switchTrack.classList.replace('bg-blue-600', 'bg-gray-300');
                switchDot.style.transform = 'translateX(0)';
            }
        }
        darkModeSwitch.addEventListener('change', () => {
            setDarkMode(darkModeSwitch.checked);
            localStorage.setItem('darkMode', darkModeSwitch.checked ? 'on' : 'off');
        });
        // Persist mode across reloads
        if (localStorage.getItem('darkMode') === 'on') {
            setDarkMode(true);
        } else {
            setDarkMode(false);
        }

        // --- App Initialization ---
        import { initAuth } from './js/auth.js';
        import { initNavigation, navigateToDefaultPage } from './js/navigation.js';

        function onLoginSuccess() {
            navigateToDefaultPage();
        }

        initNavigation();
        initAuth(onLoginSuccess);
    </script>
</body>
</html>